var todoApp = angular.module("todoApp");
 
  todoApp.controller('homeController', function ($scope, homeService, $timeout,  $mdSidenav, $window) {
	  
	  var getNotes=function(){
	    	var url = 'noteList';
	    	var notes=homeService.service(url,'GET',notes);
	    	notes.then(function(response){
	    		$scope.notes=response.data;
	    		console.log("$scope.notes::",$scope.notes);
	    	},function(response){
	    		$scope.error=response.data.responseMessage;
	    		$location.path('login');
	    	});
			$scope.notes=notes;

	    }
	 
	  $scope.createNote = function() {
			 $scope.note = {};
			 var url = 'addNote'
				$scope.note.title= document.getElementById("title").innerHTML;
				$scope.note.description= document.getElementById("description").innerHTML;
			
				var notes = homeService.service(url,'POST',$scope.note);
				notes.then(function(response) {
					getNotes();
					document.getElementById("title").innerHTML = "";
					document.getElementById("description").innerHTML = "";						

				}, function(response) {
					getNotes();
					$scope.error = response.data.message;

				});
	  }
	
	   $scope.deleteNote = function(note) {
				 console.log($scope.note);
				 note.trash=true;
				 var url='update';
				 var notes = homeService.service(url,'PUT',note);
					notes.then(function(response) {
			        getNotes();

					}, function(response) {
						$scope.error = response.data.message;
					});
			 }

				//
     $scope.deleteForever=function(note){
				 var url='delete/'+note.id;
				 var notes = homeService.service(url,'DELETE',note);
				 notes.then(function(response) {
				 getNotes();

				  }, function(response) {
					getNotes();
				    $scope.error = response.data.message;
						});
				    }
				$scope.restoreNote=function(note){
	    		note.trash=0;
	    		var url='update';
	    		var notes = homeService.service(url,'PUT',note);
	    		notes.then(function(response) {
	    			getNotes();
	    		}, function(response) {
	    			getNotes();
	    			$scope.error = response.data.message;
	    		});
	    	}
				
				$scope.updateNote = function(note, event) {
					console.log(note);
				    $mdDialog.show({
				      locals: {
				        dataToPass: note  
				      },
				      templateUrl: 'template/UpdateNote.html',
				      parent: angular.element(document.body),
				      targetEvent: event,
				      clickOutsideToClose: true,
				      controllerAs: 'controller',
				      controller: mdDialogController
				    });
				}
				
				function mdDialogController($scope, $state, dataToPass) {
				      $scope.mdDialogData = dataToPass;
				      	$scope.saveUpdatedNote = function() {
				    	var url = 'update';
				    	
				    	console.log(dataToPass);
				    	
				    	dataToPass.title = document.getElementById("updatedNoteTitle").innerHTML;
				    	
				    	dataToPass.body = document.getElementById("updatedNoteBody").innerHTML;
				    	console.log(updatedNoteTitle+' '+updatedNoteBody)
				  		var notes = noteService.service(url,'POST',dataToPass)
				  		
				  		notes.then(function(response){
							console.log("success")
						},function(response){
							$scope.error=response.data.responseMessage;
						});
				      
				
		    getNotes();
	});